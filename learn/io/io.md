# 输出输出系统

## 键盘

在键盘中断中，我们像初始化时钟中断一样，设置中断处理函数，开启中断，当时我们的键盘中断在响应了一次以后就没有了反应。

下面at 和 ps/2 键盘的一些基础知识

### 键盘敲击的过程

在键盘中存在一个键盘编码器的芯片，它通常是 Intel 8048以及兼容芯片，作用是监视键盘的输入，并把适当数据传送给计算机。在计算机主板上还有一个键盘控制器，用来接受和解码来自键盘的数据，并与 8259A 以及软件等进行通信。
敲击键盘的动作有两个含义，动作和内容。动作可以分为按下，保持按住的状态以及放开，内容是键盘上不同地方的键。根据敲击的动作和内容，8048 要出现不同的反应。
敲击键盘所产生的编码成为扫描码（scan code）， 它分为make code 和break code 两类。 当一个键被按下或者保持按下，都会产生make code。当键被弹起， 产生break code。除了pause键，每一个按键都会对应一个make code和一个break code。
当8048 检测到一个键的动作时，会把相应的扫描码发给8042， 8042 会把它转换为相应的scan code set 1,并将其放在输入缓冲区中，然后8042 告诉 8259A 产生中断，如果此时又有新的按键被按下，8042将不在接受，一直到缓冲区被清空，8042才会收到更多的扫描码。
所以在这里我们知道，只有我们将扫描码从缓冲区读出来，才能接收到新的按键。

### 键盘缓冲区

因为我们的键盘控制器的缓冲区只要一个字节，那么因为我们有的键盘是两个自己以上的，这就为我们键盘的解析带来了困难，这时候我们需要建立一个键盘缓冲区来保存一部分的键盘的输入。然后我们找一个任务来专门来解析它。

## 总结键盘解析和过程

因为键盘码分为make code和break code，而且还有可能存在组合键，并且8042每次只能接受给一个字节，那么我们很容易就想到可以使用缓冲区，那么我们在有字节到来的时候产生一个类似与读者，写者问题的缓冲区。当键盘的输入超过缓冲区的时候我们就直接丢弃这个scan code。

下面我们就需要开始读这个部分了，什么时候开始读？我们选择新建一个任务来完成这个部分，专门来解析这个我们键盘的输入。
就像上面说的，我们知道有组合键的存在，那我们就需要提供一组数据来保存这些组合键的状态，既然有break code和scan code我们选择一个两个字节的代码来暂存他们。
我们处理的过程中，首先把所有的屏幕暂停的按钮来解析出去，然后我们把所有截屏的按钮解析出去。

接下来就开始就开始解析所有的可打印的代码，我们首先解析是否shift被按下，这关系到我们解析是到哪一列。然后我们来判断是否为判断键。

然后我们设置shift的状态，通过make和break这个状态来保证键的按下和按起来。

最下面就是我们的输出模块。

## 输出系统，显示部分

在默认模式下面，我们的显存32 kb，我们每个控制台是80 × 25 × 2 = 4 kb, 所以现存中可以存放8个控制台。
显示的部分自然是交给vga系统来控制，那么首先学习vga的寄存器。